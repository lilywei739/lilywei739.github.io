<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
        <meta http-equiv="Cache-Control" content="no-siteapp" />
        <meta name="robots" content="index,follow"/>
        <meta name="renderer" content="webkit" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui" />
        <meta name="keywords" content="react redux connect">
        <meta name="screen-orientation" content="portrait" />
        <meta name="full-screen" content="yes" />
        <meta name="browsermode" content="application" />
        <meta name="x5-orientation" content="portrait" />
        <meta name="x5-fullscreen" content="true" />
        <meta name="x5-page-mode" content="app" />
        <title>react redux connect</title>
        <link rel="shortcut icon" type="image/ico" href="/favicon.ico"/>
        <link rel="stylesheet" href="/css/common/github-gist.min.css">
        <link rel="stylesheet" href="/css/style.css">
        <!--[if lt IE 9]>
        <script src="/js/common/html5.js"></script>
        <![endif]-->
    </head>
    <body>
        <!-- HEADER -->
        <div id="header_wrap" class="outer">
            <header class="inner">
                <h1 id="project_title"><a href="/index.html">Weili - GitHub.io</a></h1>
                <h2 id="project_tagline"><a href="https://github.com/lilywei739/lilywei739.github.io" target="_blank">View on GitHub</a></h2>
            </header>
        </div>
            
        <div id="content-wrapper">
            <div class="main clearfix">
                <aside id="sidebar">
                    <ul class="side-nav">
                    </ul>
                </aside>

                <section id="main-cont">
                    <h1 id="react-redux----connect">react redux – connect</h1>

<p>对于 redux 的了解不足，不对 redux 做过多的解释，以后会用心的写一篇自己对于它的理解，在项目中用到了 connect 这个知识点，在这里做下笔记。</p>

<h2 id="connect-">connect 是干什么的？</h2>

<p>Provider 内的任何一个组件（比如这里的 Comp），如果需要使用 state 中的数据，就必须是「被 connect 过的」组件——使用 connect 方法对「你编写的组件（MyComp）」进行包装后的产物。</p>

<blockquote>
  <p>connect([mapStateToProps], [mapDispatchToProps], [mergeProps], [options])</p>
</blockquote>

<p>connect() 接收四个参数，分别是 mapStateToProps，mapDispatchToProps，mergeProps和options。</p>

<p>1、mapStateToProps(state, ownProps) : stateProps</p>

<p>这个函数允许我们将 store 中的数据作为 props 绑定到组件上。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>const mapStateToProps = (state) =&gt; {
  return {
    count: state.count
  }
}
</code></pre>
</div>

<p>这个函数的第一个参数就是 Redux 的 store，我们从中摘取了 count 属性。因为返回了具有 count 属性的对象，所以 MyComp 会有名为 count 的 props 字段。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>class MyComp extends Component {
  render(){
    return &lt;div&gt;计数：{this.props.count}次&lt;/div&gt;
  }
}

const Comp = connect(...args)(MyComp);

</code></pre>
</div>

<p>当然，你不必将 state 中的数据原封不动地传入组件，可以根据 state 中的数据，动态地输出组件需要的（最小）属性。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>const mapStateToProps = (state) =&gt; {
  return {
    greaterThanFive: state.count &gt; 5
  }
}
</code></pre>
</div>

<p>函数的第二个参数 ownProps，是 MyComp 自己的 props。有的时候，ownProps 也会对其产生影响。比如，当你在 store 中维护了一个用户列表，而你的组件 MyComp 只关心一个用户（通过 props 中的 userId 体现）。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>const mapStateToProps = (state, ownProps) =&gt; {
  // state 是 {userList: [{id: 0, name: '王二'}]}
  return {
    user: _.find(state.userList, {id: ownProps.userId})
  }
}

class MyComp extends Component {
  
  static PropTypes = {
    userId: PropTypes.string.isRequired,
    user: PropTypes.object
  };
  
  render(){
    return &lt;div&gt;用户名：{this.props.user.name}&lt;/div&gt;
  }
}

const Comp = connect(mapStateToProps)(MyComp);

</code></pre>
</div>

<p>当 state 变化，或者 ownProps 变化的时候，mapStateToProps 都会被调用，计算出一个新的 stateProps，（在与 ownProps merge 后）更新给 MyComp。</p>

<p>这就是将 Redux store 中的数据连接到组件的基本方式。</p>

<p>2、mapDispatchToProps(dispatch, ownProps): dispatchProps</p>

<p>connect 的第二个参数是 mapDispatchToProps，它的功能是，将 action 作为 props 绑定到 MyComp 上。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>const mapDispatchToProps = (dispatch, ownProps) =&gt; {
  return {
    increase: (...args) =&gt; dispatch(actions.increase(...args)),
    decrease: (...args) =&gt; dispatch(actions.decrease(...args))
  }
}

class MyComp extends Component {
  render(){
    const {count, increase, decrease} = this.props;
    return (&lt;div&gt;
      &lt;div&gt;计数：{this.props.count}次&lt;/div&gt;
      &lt;button onClick={increase}&gt;增加&lt;/button&gt;
      &lt;button onClick={decrease}&gt;减少&lt;/button&gt;
    &lt;/div&gt;)
  }
}

const Comp = connect(mapStateToProps， mapDispatchToProps)(MyComp);
</code></pre>
</div>

<p>由于 mapDispatchToProps 方法返回了具有 increase 属性和 decrease 属性的对象，这两个属性也会成为 MyComp 的 props。</p>

<p>如上所示，调用 actions.increase() 只能得到一个 action 对象 {type:’INCREASE’}，要触发这个 action 必须在 store 上调用 dispatch 方法。diapatch 正是 mapDispatchToProps 的第一个参数。但是，为了不让 MyComp 组件感知到 dispatch 的存在，我们需要将 increase 和 decrease 两个函数包装一下，使之成为直接可被调用的函数（即调用该方法就会触发 dispatch）。</p>

<p>Redux 本身提供了 bindActionCreators 函数，来将 action 包装成直接可被调用的函数。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>import {bindActionCreators} from 'redux';

const mapDispatchToProps = (dispatch, ownProps) =&gt; {
  return bindActionCreators({
    increase: action.increase,
    decrease: action.decrease
  });
}
</code></pre>
</div>

<p>同样，当 ownProps 变化的时候，该函数也会被调用，生成一个新的 dispatchProps，（在与 statePrope 和 ownProps merge 后）更新给 MyComp。注意，action 的变化不会引起上述过程，默认 action 在组件的生命周期中是固定的。</p>

<p>3、[mergeProps(stateProps, dispatchProps, ownProps): props]</p>

<p>之前说过，不管是 stateProps 还是 dispatchProps，都需要和 ownProps merge 之后才会被赋给 MyComp。connect 的第三个参数就是用来做这件事。通常情况下，你可以不传这个参数，connect 就会使用 Object.assign 替代该方法。</p>

<p>最后还有一个 options 选项，比较简单，基本上也不大会用到，先忽略。</p>


		<div class="PageNavigation">
		  
		    <a class="prev" href="/2017/06/12/video-inline-play.html">&laquo; H5 video 视频在QQ、微信中播放视频不全屏</a>
		  
		  
		</div>
		<!-- 多说评论框 start -->
        <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
        <!--
<div id="ds_ele" class="ds-thread" data-thread-key="" data-title="react redux connect" data-url="http://lilywei739.github.io/react/redux/2017/08/04/react_redux_connect.html"></div>
		    <script type="text/javascript">
                        var url = window.location.pathname;
                        url = url.substr(1, url.length -6).replace(/\//gi, '_');
                        document.getElementById('ds_ele').dataset.threadKey = url;
                        var duoshuoQuery = {short_name:"github"};
                        (function() {
                            var ds = document.createElement('script');
                            ds.type = 'text/javascript';ds.async = true;
                            ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
                            ds.charset = 'UTF-8';
                            (document.getElementsByTagName('head')[0] 
                            || document.getElementsByTagName('body')[0]).appendChild(ds);
                        })();

                    </script>
                    -->
		<!-- 多说公共JS代码 end -->
                </section>
            </div>
        </div>
            
        <!-- FOOTER  -->
        <div id="footer_wrap" class="outer">
            <footer class="inner">
                <p>© 2016  by Weili &nbsp;&nbsp;  |  &nbsp;&nbsp;托管在 - <a href="https://pages.github.com">GitHub</a></p>
            </footer>
        </div>
        <script src="/js/common/jquery-2.2.4.min.js"></script>
        <script src="/js/common/highlight.min.js"></script>
        <script src="/js/aside-nav.js"></script>
        <script>
            // baidu 统计
            var _hmt = _hmt || [];
            (function() {
                var hm = document.createElement("script");
                hm.src = "//hm.baidu.com/hm.js?146fe495fee020bf0e4dd701aa73965f";
                var s = document.getElementsByTagName("script")[0]; 
                s.parentNode.insertBefore(hm, s);
            })();
            // highlight
            hljs.initHighlightingOnLoad({useBR: true});
            $(document).ready(function() {
                $('pre code').each(function(i, block) {
                    hljs.highlightBlock(block);
                });

                // http2
                var img = new Image();
                img.src = 'https://www.h2statistics.ml/';
            });
        </script>
    </body>
</html>
